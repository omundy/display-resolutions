<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Display Resolutions</title>

	<!-- 
    Title: Display Resolutions
    References: 
		https://web.archive.org/web/20171108190059/http://www.latenighthacking.com/projects/monitorResolutions.html
		https://www.david-smith.org/blog/2014/01/09/visualizing-display-resolutions/
		https://www.logicalincrements.com/resolution
		https://en.wikipedia.org/wiki/List_of_common_display_resolutions
    Author: Owen Mundy
    Date: 2024
    License: MIT
    -->

	<link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

	<main>
		<form id="controls" class="controls">
			<div>
				<label for="scale">scale</label>
				<input type="range" id="scale" min=".1" max="2.0" step="0.01" value="1">
				<input type="text" id="scaleDisplay" value="1" class="val">
			</div>
			<div>
				<button class="saveSVG">download</button>
			</div>
		</form>
		<!-- SVG height always fits the element, while viewbox 100 100 makes all numbers relative to % -->
		<svg width="3840" height="2400" viewBox="0 0 3840 2400" style="font-family: sans-serif;" xmlns="http://www.w3.org/2000/svg"></svg>
	</main>

	<script type="module">

		import { PALETTE_ARR } from "./assets/js/palette.js";
		import { tsv } from "https://cdn.skypack.dev/d3-fetch@3";
		let data = await tsv("/displays.tsv");
		console.log(data);

		let scale = 1;
		const svg = document.querySelector('svg');
		const controlsEle = document.querySelector('#controls');
		const scaleEle = document.querySelector('#scale');
		const scaleDisplayEle = document.querySelector('#scaleDisplay');
		scaleEle.addEventListener("input", (e) => {
			scale = e.target.value;
			scaleDisplay.value = scale;
			generate();
		})

		function generate() {
			document.body.style.backgroundColor = "#212121";

			let output = '';
			let winW = window.innerWidth,
				winH = window.innerHeight,
				colorIndex = 0;
			for (let i = data.length; i > 0; i--) {
				if (!data[i]) continue;
				let w = Number(data[i].pixels.split("x")[0]),
					h = Number(data[i].pixels.split("x")[1]),
					x = 0,
					y = 0,
					fontSize = 20 * scale,
					color = PALETTE_ARR[colorIndex++] // sequential
					// color = PALETTE_ARR[Math.floor(Math.random() * PALETTE_ARR.length)] // random
					;
				let currentW = w * scale,
					currentH = h * scale;

				if (colorIndex >= PALETTE_ARR.length)
					colorIndex = 0;
				// console.log("ðŸ¦„", "w,h", w, h, "x,y", x, y, "scale", scale, colorIndex, color);

				output += `<rect
							width="${currentW}" height="${currentH}" x="0" y="0" 
							fill="${color}" stroke="none" opacity=".6"
							 />`
				output += `<text 
							width="200" height="30" 
							x="${currentW}" y="${currentH}" 
							text-anchor="end"
							fill="#fff" stroke="none"
							font-size="${fontSize}"
							transform ="translate(${x - 4},${y - 4})">${data[i].name} ${data[i].aspectRatio} ${w}x${h}</text>`;
			}
			// display
			svg.innerHTML = output;
		}

		// listeners
		window.addEventListener("load", generate);
		window.addEventListener("resize", generate);


		function download(filename, textInput) {
			var element = document.createElement('a');
			element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(textInput));
			element.setAttribute('download', filename);
			document.body.appendChild(element);
			element.click();
			document.body.removeChild(element);
			console.log("File saved", filename);
		}
		document.querySelector(".saveSVG").addEventListener("click", function (e) {
			e.preventDefault();
			let str = `<?xml version="1.0" encoding="utf-8" ?>${svg.outerHTML}`;
			// console.log("str", str);
			download("displays.svg", str);
		}, false);

	</script>

</body>
</html>